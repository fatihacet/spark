<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Spark Framework Source: core/Router.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.dark.css">

	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Spark Framework</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu inline">
						
						<li>
							<a href="spark.components.Button.html">spark.components.Button</a>
						</li>
						
						<li>
							<a href="spark.components.Checkbox.html">spark.components.Checkbox</a>
						</li>
						
						<li>
							<a href="spark.components.ComboBox.html">spark.components.ComboBox</a>
						</li>
						
						<li>
							<a href="spark.components.DraggableView.html">spark.components.DraggableView</a>
						</li>
						
						<li>
							<a href="spark.components.Field.html">spark.components.Field</a>
						</li>
						
						<li>
							<a href="spark.components.Form.html">spark.components.Form</a>
						</li>
						
						<li>
							<a href="spark.components.Input.html">spark.components.Input</a>
						</li>
						
						<li>
							<a href="spark.components.Label.html">spark.components.Label</a>
						</li>
						
						<li>
							<a href="spark.components.LabeledInput.html">spark.components.LabeledInput</a>
						</li>
						
						<li>
							<a href="spark.components.Modal.html">spark.components.Modal</a>
						</li>
						
						<li>
							<a href="spark.components.Overlay.html">spark.components.Overlay</a>
						</li>
						
						<li>
							<a href="spark.components.Password.html">spark.components.Password</a>
						</li>
						
						<li>
							<a href="spark.components.Radio.html">spark.components.Radio</a>
						</li>
						
						<li>
							<a href="spark.components.Textarea.html">spark.components.Textarea</a>
						</li>
						
						<li>
							<a href="spark.components.ToggleSwitch.html">spark.components.ToggleSwitch</a>
						</li>
						
						<li>
							<a href="spark.core.HistorManager.TokenTransformer.html">spark.core.HistorManager.TokenTransformer</a>
						</li>
						
						<li>
							<a href="spark.core.HistoryManager.html">spark.core.HistoryManager</a>
						</li>
						
						<li>
							<a href="spark.core.Object.html">spark.core.Object</a>
						</li>
						
						<li>
							<a href="spark.core.Router.html">spark.core.Router</a>
						</li>
						
						<li>
							<a href="spark.core.Store.html">spark.core.Store</a>
						</li>
						
						<li>
							<a href="spark.core.View.html">spark.core.View</a>
						</li>
						
						<li>
							<a href="spark.widgets.SignUp.html">spark.widgets.SignUp</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: core/Router.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">// Generated by github.com/steida/coffee2closure 0.1.9
goog.provide('spark.core.Router');
goog.require('spark.core.Object');
goog.require('spark.core.HistoryManager');
goog.require('goog.Uri');

/**
  Router manager class with built-in HistoryManager. Add routes to router and
  let Router to handle those routes along with HistoryManager.

  @constructor
  @export
  @param   {Object=} options Class options.
  @param   {*=} data Class data
  @extends {spark.core.Object}
 */
spark.core.Router = function(options, data) {
  var _ref;
  if (options == null) {
    options = {};
  }
  options.useHtml5History || (options.useHtml5History = (_ref = options['useHtml5History']) != null ? _ref : false);
  spark.core.Router.superClass_.constructor.call(this, options, data);
  this.historyManager = new spark.core.HistoryManager({
    useHtml5History: options.useHtml5History
  });
  this.routes = {};
  this.routeRegexes = {};
  this.latestHandledRoute = null;
  this.historyManager.on('Navigated', (function(_this) {
    return function(e) {
      var path;
      path = e.data;
      if (_this.latestHandledRoute !== path) {
        _this.handleRoute_(path);
        return _this.latestHandledRoute = path;
      }
    };
  })(this));
}
goog.inherits(spark.core.Router, spark.core.Object);

/**
  Add route with callback function to handle it.

  @export
  @param {!string} route Route path.
  @param {!Function} callback Callback to handle route action.
 */
spark.core.Router.prototype.addRoute = function(route, callback) {
  this.routes[route] = callback;
  return this.createRegexRoute_(route);
};

/**
  Sets HistoryManager's token to update URL. When history token is changed
  HistoryManager will emit Navigated event. It's handled in here and it will
  call the correct callback for that route.

  @export
  @param {string} path Path to change the active route.
 */
spark.core.Router.prototype.route = function(path) {
  return this.historyManager.setToken(path);
};

/**
  Handle route for current page path. This is useful for handling the initial
  route of the page when page reload. This method should be called by user
  because Router doesn't actually know when all routes are added.

  TODO: Rename this method.
  @export
 */
spark.core.Router.prototype.init = function() {
  var host, href, protocol, route, _ref;
  _ref = document.location, href = _ref.href, host = _ref.host, protocol = _ref.protocol;
  route = href.replace("" + protocol + "//" + host, '');
  return this.handleRoute_(route.replace('/#', ''));
};

/**
  Returns the currently added routes.

  @export
  @return {Object} Routes object.
 */
spark.core.Router.prototype.getRoutes = function() {
  return this.routes;
};

/**
  Returns spark.core.HistoryManager instance.

  @export
  @return {spark.core.HistoryManager} HistoryManager instance of the Router.
 */
spark.core.Router.prototype.getHistoryManager = function() {
  return this.historyManager;
};

/**
  Execute callback function for particular route path.

  @private
 */
spark.core.Router.prototype.handleRoute_ = function(path) {
  var cb, index, key, params, query, queryData, queryKeys, queryValues, regex, route, token, tokens, uri, values, _i, _j, _len, _len1, _ref, _results;
  uri = new goog.Uri(path);
  path = uri.getPath();
  params = null;
  query = null;
  queryData = uri.getQueryData();
  queryKeys = queryData.getKeys();
  queryValues = queryData.getValues();
  if (queryKeys.length) {
    query = {};
    for (index = _i = 0, _len = queryKeys.length; _i &lt; _len; index = ++_i) {
      key = queryKeys[index];
      query[key] = queryValues[index];
    }
  }
  cb = this.routes[path];
  if (cb) {
    return cb.call(this, params, query);
  }
  _ref = this.routeRegexes;
  _results = [];
  for (route in _ref) {
    regex = _ref[route];
    values = regex.exec(path);
    if (!values) {
      continue;
    }
    cb = this.routes[route];
    tokens = route.match(/(:\w+)/g);
    params = {};
    values.shift();
    for (index = _j = 0, _len1 = tokens.length; _j &lt; _len1; index = ++_j) {
      token = tokens[index];
      token = token.replace(/:/g, '');
      params[token] = values[index];
    }
    _results.push(cb != null ? cb.call(this, params, query) : void 0);
  }
  return _results;
};

/**
  Creates a regex for route to match actual page link with our routes.
  This method create a regex like `\/activity\/post\/(\w+)\/comment\/(\w+)$`
  to match this route `/activity/post/1/comment/2`. Here is the regex101
  https://www.regex101.com/r/wX2kB6/1

  @private
  @param {!string} route Actual page route.
  @return {RegExp|undefined} RegExp to match page URL.
 */
spark.core.Router.prototype.createRegexRoute_ = function(route) {
  var captureParams, escapeSlashes, routeRegex;
  if (route.indexOf(':') === -1) {
    return;
  }
  escapeSlashes = /\//g;
  captureParams = /:(\w+)/g;
  routeRegex = route.replace(escapeSlashes, '\/').replace(captureParams, '(\\w+)');
  return this.routeRegexes[route] = new RegExp("" + routeRegex + "$");
};

/**
  Destroy the router instance. If you want to create a new router instance
  for some reason, you have to destroy previously created instances. Otherwise
  HistoryManager events will be triggered multiple times.

  @expose
 */
spark.core.Router.prototype.destroy = function() {
  return this.historyManager.disposeInternal();
};</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					Spark Framework by Fatih Acet <fatih@fatihacet.com>
					<br />
					
					
		<span class="copyright">
		Copyright Â© 2014 - Fatih Acet
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on 2015-01-03T15:10:49+00:00 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
